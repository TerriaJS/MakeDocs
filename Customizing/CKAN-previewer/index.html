<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>CKAN previewer - Terria</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Terria</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">CatalogManagement <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../CatalogManagement/@Overview/">@Overview</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/CKAN/">CKAN</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Format-Conversion-Service/">Format Conversion Service</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/GeoJSON/">GeoJSON</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Handling-CORS/">Handling CORS</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Initialization-File/">Initialization File</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Performance-testing/">Performance testing</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Web-Map-Service/">Web Map Service</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributors <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../Contributors/@Overview/">@Overview</a>
</li>

                    
                        
<li >
    <a href="../../Contributors/CONTRIBUTING/">CONTRIBUTING</a>
</li>

                    
                        
<li >
    <a href="../../Contributors/Contributing-to-TerriaJS/">Contributing to TerriaJS</a>
</li>

                    
                        
<li >
    <a href="../../Contributors/Development-environment/">Development environment</a>
</li>

                    
                        
<li >
    <a href="../../Contributors/Setting-up-Saucelabs-Locally/">Setting up Saucelabs Locally</a>
</li>

                    
                        
<li >
    <a href="../../Contributors/Using-Docker/">Using Docker</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Customizing <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../@Overview/">@Overview</a>
</li>

                    
                        
<li class="active">
    <a href="./">CKAN previewer</a>
</li>

                    
                        
<li >
    <a href="../Config-JSON/">Config JSON</a>
</li>

                    
                        
<li >
    <a href="../Extending-TerriaJS/">Extending TerriaJS</a>
</li>

                    
                        
<li >
    <a href="../How-to-skin-a-Terria-Map/">How to skin a Terria Map</a>
</li>

                    
                        
<li >
    <a href="../TerriaJS-URL-parameters/">TerriaJS URL parameters</a>
</li>

                    
                        
<li >
    <a href="../TerriaJS-in-iframe/">TerriaJS in iframe</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Deployment <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../Deployment/@Overview/">@Overview</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Deploying-Terria-Map/">Deploying Terria Map</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Deploying-and-building-TerriaJS/">Deploying and building TerriaJS</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Overall-system-architecture/">Overall system architecture</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Problems-and-Solutions/">Problems and Solutions</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Setting-up-a-region-mapping-server/">Setting up a region mapping server</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Using-a-vector-tile-source-for-region-mapping/">Using a vector tile source for region mapping</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/WMS-Services/">WMS Services</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../@Overview/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../Config-JSON/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#ckan-previewer">CKAN previewer</a></li>
        
            <li><a href="#to-create-a-ckan-installation-with-docker">To create a CKAN installation with docker</a></li>
        
            <li><a href="#to-create-a-ckan-installation-from-source">To create a CKAN installation from source</a></li>
        
            <li><a href="#to-add-cesium-previewer">To add Cesium Previewer</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h2 id="ckan-previewer">CKAN previewer</h2>
<p>The CKAN previewer is a plugin for CKAN which uses TerriaJS to preview geospatial content using an iframe. It is provided in the <a href="https://github.com/TerriaJS/TerriaMap/tree/master/ckanext-cesiumpreview">/ckanext-cesiumpreview folder of TerriaMap</a>.</p>
<h3 id="to-create-a-ckan-installation-with-docker">To create a CKAN installation with docker</h3>
<p>Follow the instructions in the CKAN documentation <a href="http://docs.ckan.org/en/latest/maintaining/installing/install-using-docker.html">here</a></p>
<h3 id="to-create-a-ckan-installation-from-source">To create a CKAN installation from source</h3>
<p>Install a local instance of CKAN per http://docs.ckan.org/en/ckan-2.0/install-from-source.html
Follow all the steps :
<em> In step 1 install openjdk-7-jdk instead of openjdk-6-jdk
</em> in step 2c use requirements.txt instead of pip-requirements.txt
<em> In step 3 making 'pass' your password will makes things simpler
</em> Set up the optional Solr install as per step 5 (Single Solr instance)
<em> Step 6 can take a long time.  If it does fail drop the ckan_default database and redo step 3 and try again
</em> You do no need to set up the optional DataStore install as per step 7 </p>
<p>To add local storage of files</p>
<pre><code>sudo mkdir -p /var/lib/ckan/default
sudo chmod 777 /var/lib/ckan/default
</code></pre>
<p>in development.ini under storage settings add</p>
<pre><code>nano /etc/ckan/default/development.ini
ckan.storage_path = /var/lib/ckan/default
</code></pre>
<p>And to run the server</p>
<pre><code>. /usr/lib/ckan/default/bin/activate
cd /usr/lib/ckan/default/src/ckan
paster serve /etc/ckan/default/development.ini
</code></pre>
<p>To install spatial extension for spatial queries and previewers, see http://docs.ckan.org/projects/ckanext-spatial/en/latest/install.html</p>
<h4 id="to-make-sysadmin-account">To make sysadmin account</h4>
<pre><code>paster sysadmin add admin -c /etc/ckan/default/development.ini
</code></pre>
<h3 id="to-add-cesium-previewer">To add Cesium Previewer</h3>
<p>TODO: Update this to use our ckan previewer plugin.  Will require a standalone github be created for the plugin</p>
<p><code>pip install -e git+https://github.com/NICTA/nationalmap-preview#egg=cesiumpreviewer</code></p>
<p>Make a virtual link to the viewer in CKAN to the cesiumviewer.</p>
<pre><code>ln -s ~/nationalmap/ckanext-cesiumpreview/ckanext/cesiumpreview ~/ckan/lib/default/src/ckan/ckanext/cesiumpreview
</code></pre>
<p>In the CKAN development.ini under storage settings add the plugin</p>
<pre><code>nano /etc/ckan/default/development.ini
ckan.plugins = cesium_viewer ...
</code></pre>
<p>There may be a more automatic way to do this, but I'm just patching files in CKAN to handle the cesium previewer in the same way as the recline previewer.  So first open setup.py for editing.  </p>
<pre><code>nano ~/ckan/lib/default/src/ckan/setup.py
</code></pre>
<p>And add the following line under the recline_preview plugin entry (line ~76)</p>
<pre><code> 'cesium_preview = ckanext.reclinepreview.plugin:CesiumPreview',
</code></pre>
<p>Then patch entry_points.txt</p>
<pre><code>  nano ~/ckan/lib/default/src/ckan/ckan.egg-info/entry_points.txt
</code></pre>
<p>And add the following line under the recline_preview plugin entry (line ~76)</p>
<pre><code>  cesium_preview = ckanext.cesiumpreview.plugin:CesiumPreview
</code></pre>
<p>That should be it.  The cesium previewer is pointing to the instance at nationalmap.research.nicta.com.au.  If you need to update the cesium_previewer path to a different location then edit the vis_server variable in preview_cesium.js</p>
<pre><code>  nano ~/nationalmap/cesiumpreview/theme/public/preview_cesium.js
</code></pre>
<p>If all went correctly you should be able to start the CKAN server in virtualenv and access the server at http://127.0.0.1:5000/</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>