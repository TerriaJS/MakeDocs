<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Development environment - Terria</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Terria</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">CatalogManagement <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../CatalogManagement/@Overview/">@Overview</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/CKAN/">CKAN</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Format-Conversion-Service/">Format Conversion Service</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/GeoJSON/">GeoJSON</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Handling-CORS/">Handling CORS</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Initialization-File/">Initialization File</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Performance-testing/">Performance testing</a>
</li>

                    
                        
<li >
    <a href="../../CatalogManagement/Web-Map-Service/">Web Map Service</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributors <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../@Overview/">@Overview</a>
</li>

                    
                        
<li >
    <a href="../CONTRIBUTING/">CONTRIBUTING</a>
</li>

                    
                        
<li >
    <a href="../Contributing-to-TerriaJS/">Contributing to TerriaJS</a>
</li>

                    
                        
<li class="active">
    <a href="./">Development environment</a>
</li>

                    
                        
<li >
    <a href="../Setting-up-Saucelabs-Locally/">Setting up Saucelabs Locally</a>
</li>

                    
                        
<li >
    <a href="../Using-Docker/">Using Docker</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Customizing <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../Customizing/@Overview/">@Overview</a>
</li>

                    
                        
<li >
    <a href="../../Customizing/CKAN-previewer/">CKAN previewer</a>
</li>

                    
                        
<li >
    <a href="../../Customizing/Config-JSON/">Config JSON</a>
</li>

                    
                        
<li >
    <a href="../../Customizing/Extending-TerriaJS/">Extending TerriaJS</a>
</li>

                    
                        
<li >
    <a href="../../Customizing/How-to-skin-a-Terria-Map/">How to skin a Terria Map</a>
</li>

                    
                        
<li >
    <a href="../../Customizing/TerriaJS-URL-parameters/">TerriaJS URL parameters</a>
</li>

                    
                        
<li >
    <a href="../../Customizing/TerriaJS-in-iframe/">TerriaJS in iframe</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Deployment <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../Deployment/@Overview/">@Overview</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Deploying-Terria-Map/">Deploying Terria Map</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Deploying-and-building-TerriaJS/">Deploying and building TerriaJS</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Overall-system-architecture/">Overall system architecture</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Problems-and-Solutions/">Problems and Solutions</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Setting-up-a-region-mapping-server/">Setting up a region mapping server</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/Using-a-vector-tile-source-for-region-mapping/">Using a vector tile source for region mapping</a>
</li>

                    
                        
<li >
    <a href="../../Deployment/WMS-Services/">WMS Services</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../Contributing-to-TerriaJS/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../Setting-up-Saucelabs-Locally/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#setting-up-a-terriajs-development-environment">Setting up a TerriaJS development environment</a></li>
        
            <li><a href="#updating-build">Updating Build</a></li>
        
            <li><a href="#building-a-terria-based-site-against-a-modified-terriajs">Building a Terria based site against a modified TerriaJS</a></li>
        
            <li><a href="#committing-modifications">Committing modifications</a></li>
        
            <li><a href="#release-build">Release Build</a></li>
        
            <li><a href="#documentation">Documentation</a></li>
        
            <li><a href="#tests-specs">Tests / Specs</a></li>
        
            <li><a href="#gulp-tasks">Gulp Tasks</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="setting-up-a-terriajs-development-environment">Setting up a TerriaJS development environment</h1>
<p>First, <a href="../../Deployment/Deploying-Terria-Map/">deploy and build your instance</a>.</p>
<h2 id="updating-build">Updating Build</h2>
<p>The following commands are what you would normally run to pull changes from GitHub and build them:</p>
<pre><code>git pull --rebase
npm install
gulp
npm start
</code></pre>

<h2 id="building-a-terria-based-site-against-a-modified-terriajs">Building a Terria based site against a modified TerriaJS</h2>
<p>What if you need to make changes to <a href="https://github.com/TerriaJS/terriajs">TerriaJS</a> while working on a site that depends on it?</p>
<p>In the process above, the <a href="https://www.npmjs.com/package/terriajs">TerriaJS package</a> is installed to the <code>node_modules</code> directory by <code>npm install</code>.  Please do not edit TerriaJS directly in the <code>node_modules</code> directory, because changes will be clobbered the next time you run <code>npm install</code>.  Instead, follow these instructions.</p>
<p>First, set up a TerriaJS dev environment on your system by following the <a href="https://github.com/TerriaJS/terriajs/wiki/Developers%27-Handbook">instructions</a>.  Then, checkout an appropriate version of TerriaJS.  To use the exact version that National Map is expecting, do:</p>
<pre><code class="bash">cd nationalmap
grep terriajs package.json
# will print something like: &quot;terriajs&quot;: &quot;0.0.23&quot;
cd ../terriajs
git checkout 0.0.23 # version from above

# Create a new branch to hold your changes.
git checkout -b someBranchName
</code></pre>

<p>If you're planning to upgrade National Map's version of TerriaJS, you may choose to use <code>master</code> instead of the precise version listed in <code>package.json</code>.</p>
<p>Next, link your local version of TerriaJS into the global npm package repository:</p>
<pre><code>cd terriajs
npm link
</code></pre>

<p>Then, link the now global <code>terriajs</code> package into National Map:</p>
<pre><code>cd nationalmap
npm link terriajs
</code></pre>

<p>This process essentially makes National Map's <code>node_modules/terriajs</code> into a symlink to your <code>terriajs</code> directory cloned from git.  Any changes you make to TerriaJS will be automatically picked up by National Map.  Don't forget to run <code>npm install</code> in TerriaJS after pulling new changes or modifying <code>package.json</code>.  You will also need to build TerriaJS (by running <code>gulp</code>) if you modify any Cesium shaders or make changes to Cesium code that could affect Cesium's WebWorkers.</p>
<p>To switch National Map back to using the npm version of TerriaJS, do:</p>
<pre><code>npm unlink terriajs
npm install
</code></pre>

<h2 id="committing-modifications">Committing modifications</h2>
<p>If you make changes to TerriaJS and National Map together, here's the process for getting them to production.</p>
<p>First, commit your TerriaJS changes to a branch and open a pull request to merge that branch to master. Simultaneously, you may want to make a branch of National Map that uses your modified version of TerriaJS.  To do that, modify National Map's <code>package.json</code>.  Where it has a line like:</p>
<pre><code>&quot;terriajs&quot;: &quot;^0.0.27&quot;,
</code></pre>

<p>Change it to:</p>
<pre><code>&quot;terriajs&quot;: &quot;git://github.com/TerriaJS/terriajs.git#branchName&quot;,
</code></pre>

<p>Replace <code>branchName</code> with the name of the TerriaJS branch you want to use.  You may even use a repository other than <code>TerriaJS/terriajs</code> if your branch is in a fork of TerriaJS instead of in the official repository.</p>
<p>Once your TerriaJS pull request has been merged and a new version of the <code>terriajs</code> npm module has been published, please remember to update <code>package.json</code> to point to an official <code>terriajs</code> version instead of a branch in a GitHub repo.</p>
<p>When at all possible, the <code>package.json</code> in the <code>master</code> branch should point to official releases of <code>terriajs</code> on npm, NOT GitHub branches.</p>
<h2 id="release-build">Release Build</h2>
<p>If you want to make a minified release build use the commands:</p>
<pre><code>npm install
gulp release
npm start
</code></pre>

<h2 id="documentation">Documentation</h2>
<p>Documentation is automatically generated from the source via jdocs.  It will be placed in the public/doc folder.  </p>
<p>It is still very early stages, so the documentation is rather minimal and referencing the source code is probably a better way to determine the best way to use the existing functionality.</p>
<p>You can click <a href="http://nationalmap.nicta.com.au/doc/">here</a> to reference the documentation on the National Map site.</p>
<h2 id="tests-specs">Tests / Specs</h2>
<p>The test suite is run by opening a web browser on <a href="http://localhost:3001/SpecRunner.html">http://localhost:3001/SpecRunner.html</a>.  The specs themselves are found in the <code>test/</code> directory.</p>
<h2 id="gulp-tasks">Gulp Tasks</h2>
<ul>
<li>default - Invoked by running gulp without any arguments, this task invokes the <code>build</code> and <code>lint</code> tasks.</li>
<li><code>build</code> - Builds a non-minified version of National Map AND Cesium, together in one JS file (called <code>public/build/ausglobe.js</code>). Only the parts of Cesium that we use (directly or indirectly) are pulled in. This task builds both the application and the specs.  This task may take 10 seconds or more, which is the main reason for the next task.</li>
<li><code>watch</code> - Starts the same as <code>build</code> but then it stays running and watches for changes to any National Map, spec, or Cesium source file that was pulled in to <code>ausglobe.js</code>. When a change to any of these files is detected, a fast incremental build is automatically kicked off.  The incremental build is much faster than the full rebuild because dependencies between source files are cached.</li>
<li><code>release</code> - The same as <code>build</code> except that it also minifies <code>ausglobe.js</code>.  This task should be used when building for production.</li>
<li><code>build-app</code> - The same as <code>build</code>, except it builds just the app, not the specs.</li>
<li><code>build-specs</code> - The same as <code>build</code>, except it builds just the specs, not the app.  Note that the specs do not actually depending on the app, so there is no need to <code>build-app</code> if you're just iterating on the specs, even if you change app source files.</li>
<li><code>watch-app</code> - Watches just the app for changes.</li>
<li><code>watch-specs</code> - Watches just the specs for changes.</li>
<li><code>release-app</code> - Does a release build of just the app.</li>
<li><code>release-specs</code> - Does a release build of just the specs.</li>
<li><code>lint</code> - Runs jshint on the files in the <code>src</code> folder and reports any problems.  Our <a href="https://github.com/NICTA/nationalmap/blob/master/src/.jshintrc">.jshintrc</a> file is mostly just copied from Cesium at the moment, so suggested changes are welcome.</li>
<li><code>docs</code> - Generates reference documentation for the files in the <code>src</code> folder.</li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>